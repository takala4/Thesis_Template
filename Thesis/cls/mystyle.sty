\usepackage[fleqn]{amsmath}
\usepackage{subfiles}
\usepackage{amssymb,bm}
\usepackage{mathtools}
\usepackage{mathptmx}
\usepackage{framed}
\usepackage{listings}
\usepackage{xstring}
\usepackage[dvipdfmx]{color}
\usepackage{xcolor}
\usepackage{comment}
\usepackage{chngcntr}
\usepackage{hyperref}
\hypersetup{
  colorlinks=true,
  citecolor=blue,
  linkcolor=blue,
  urlcolor=blue,
}
\usepackage{cleveref}
\usepackage{ifthen}
\usepackage{here}

\usepackage {dirtree}
% https://ichiro-maruta.blogspot.com/2010/11/texappendix.html
\usepackage[titletoc,title]{appendix}

\usepackage{booktabs}
\usepackage{multirow}
\usepackage {tablefootnote}

%Tikz======================================================================
\usepackage{tikz}
\usepackage{pgfplots}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{arrows.meta}
\usetikzlibrary{overlay-beamer-styles}
\usetikzlibrary{calc,3d}
\usetikzlibrary{matrix, positioning}
\usetikzlibrary{decorations.pathreplacing}
\usetikzlibrary{math}
\usetikzlibrary{patterns}
 
\usepackage{amsthm}
\theoremstyle{definition}
\newtheorem{thm}{定理}[section]
\newtheorem{cor}{系}[section]
\newtheorem{dfn}{定義}[section]
\newtheorem{lem}{補題}[section]
\newtheorem{asm}{仮定}[section]
\newtheorem{pro}{命題}[section]
\newtheorem{cnj}{推論}[section]
\newtheorem*{prf}{証明} % 証明は番号なし
\newtheorem*{rmk}{Remarks}% Remarksは番号なし


% \crefname{section}{Section}{Sections}
% \crefname{subection}{Section}{Sections}

\crefformat{chapter}{第#2#1#3章}
\crefformat{section}{#2#1#3}
\crefformat{subsection}{#2#1#3}

\crefname{equation}{式}{式}
\crefname{figure}{図}{図}
\crefname{table}{表}{表}

\crefname{thm}{定理}{定理}
\crefname{cor}{系}{系}
\crefname{dfn}{定義}{定義}
\crefname{lem}{補題}{補題}
\crefname{asm}{仮定}{仮定}
\crefname{pro}{命題}{命題}
\crefname{cnj}{推論}{推論}


% \crefname{section}{Section}{Sections}
% \crefname{subection}{Section}{Sections}

% \crefname{equation}{Eq.}{Eqs.}
% \crefname{figure}{Figure}{Figures}
% \crefname{table}{Table}{Tables}

% \crefname{thm}{Theorem}{Theorems}
% \crefname{cor}{Corollary}{Corollary}
% \crefname{dfn}{Definition}{Definition}
% \crefname{lem}{Lemma}{Lemmas}
% \crefname{asm}{Assumption}{Assumption}
% \crefname{pro}{Proposition}{Proposition}
% \crefname{cnj}{Conjecture}{Conjecture}

\usepackage{algorithm}
\usepackage{algpseudocode}


\usepackage[ISO]{diffcoeff}
\usepackage{txfonts}
\usepackage{pxfonts}

\usepackage{subcaption}


%\Cl and \Vt =========================
\newcommand{\ClA}{\mathcal{A}}
\newcommand{\ClB}{\mathcal{B}}
\newcommand{\ClC}{\mathcal{C}}
\newcommand{\ClD}{\mathcal{D}}
\newcommand{\ClE}{\mathcal{E}}
\newcommand{\ClF}{\mathcal{F}}
\newcommand{\ClG}{\mathcal{G}}
\newcommand{\ClH}{\mathcal{H}}
\newcommand{\ClI}{\mathcal{I}}
\newcommand{\ClJ}{\mathcal{J}}
\newcommand{\ClK}{\mathcal{K}}
\newcommand{\ClL}{\mathcal{L}}
\newcommand{\ClM}{\mathcal{M}}
\newcommand{\ClN}{\mathcal{N}}
\newcommand{\ClO}{\mathcal{O}}
\newcommand{\ClP}{\mathcal{P}}
\newcommand{\ClQ}{\mathcal{Q}}
\newcommand{\ClR}{\mathcal{R}}
\newcommand{\ClS}{\mathcal{S}}
\newcommand{\ClT}{\mathcal{T}}
\newcommand{\ClU}{\mathcal{U}}
\newcommand{\ClV}{\mathcal{V}}
\newcommand{\ClW}{\mathcal{W}}
\newcommand{\ClX}{\mathcal{X}}
\newcommand{\ClY}{\mathcal{Y}}
\newcommand{\ClZ}{\mathcal{Z}}
\newcommand{\Vt}[1]{\bm{#1}}
\newcommand{\Vta}{\bm{a}}
\newcommand{\Vtb}{\bm{b}}
\newcommand{\Vtc}{\bm{c}}
\newcommand{\Vtd}{\bm{d}}
\newcommand{\Vte}{\bm{e}}
\newcommand{\Vtf}{\bm{f}}
\newcommand{\Vtg}{\bm{g}}
\newcommand{\Vth}{\bm{h}}
\newcommand{\Vti}{\bm{i}}
\newcommand{\Vtj}{\bm{j}}
\newcommand{\Vtk}{\bm{k}}
\newcommand{\Vtl}{\bm{l}}
\newcommand{\Vtm}{\bm{m}}
\newcommand{\Vtn}{\bm{n}}
\newcommand{\Vto}{\bm{o}}
\newcommand{\Vtp}{\bm{p}}
\newcommand{\Vtq}{\bm{q}}
\newcommand{\Vtr}{\bm{r}}
\newcommand{\Vts}{\bm{s}}
\newcommand{\Vtt}{\bm{t}}
\newcommand{\Vtu}{\bm{u}}
\newcommand{\Vtv}{\bm{v}}
\newcommand{\Vtw}{\bm{w}}
\newcommand{\Vtx}{\bm{x}}
\newcommand{\Vty}{\bm{y}}
\newcommand{\Vtz}{\bm{z}}
\newcommand{\VtA}{\bm{A}}
\newcommand{\VtB}{\bm{B}}
\newcommand{\VtC}{\bm{C}}
\newcommand{\VtD}{\bm{D}}
\newcommand{\VtE}{\bm{E}}
\newcommand{\VtF}{\bm{F}}
\newcommand{\VtG}{\bm{G}}
\newcommand{\VtH}{\bm{H}}
\newcommand{\VtI}{\bm{I}}
\newcommand{\VtJ}{\bm{J}}
\newcommand{\VtK}{\bm{K}}
\newcommand{\VtL}{\bm{L}}
\newcommand{\VtM}{\bm{M}}
\newcommand{\VtN}{\bm{N}}
\newcommand{\VtO}{\bm{O}}
\newcommand{\VtP}{\bm{P}}
\newcommand{\VtQ}{\bm{Q}}
\newcommand{\VtR}{\bm{R}}
\newcommand{\VtS}{\bm{S}}
\newcommand{\VtT}{\bm{T}}
\newcommand{\VtU}{\bm{U}}
\newcommand{\VtV}{\bm{V}}
\newcommand{\VtW}{\bm{W}}
\newcommand{\VtX}{\bm{X}}
\newcommand{\VtY}{\bm{Y}}
\newcommand{\VtZ}{\bm{Z}}
\newcommand{\Vtalpha}{\bm{\alpha}}
\newcommand{\Vtbeta}{\bm{\beta}}
\newcommand{\Vtgamma}{\bm{\gamma}}
\newcommand{\Vtdelta}{\bm{\delta}}
\newcommand{\Vtepsilon}{\bm{\epsilon}}
\newcommand{\Vtvarepsilon}{\bm{\varepsilon}}
\newcommand{\Vtzeta}{\bm{\zeta}}
\newcommand{\Vteta}{\bm{\eta}}
\newcommand{\Vttheta}{\bm{\theta}}
\newcommand{\Vtvartheta}{\bm{\vartheta}}
\newcommand{\Vtiota}{\bm{\iota}}
\newcommand{\Vtkappa}{\bm{\kappa}}
\newcommand{\Vtvarkappa}{\bm{\varkappa}}
\newcommand{\Vtlambda}{\bm{\lambda}}
\newcommand{\Vtmu}{\bm{\mu}}
\newcommand{\Vtnu}{\bm{\nu}}
\newcommand{\Vtxi}{\bm{\xi}}
\newcommand{\Vtpi}{\bm{\pi}}
\newcommand{\Vtvarpi}{\bm{\varpi}}
\newcommand{\Vtrho}{\bm{\rho}}
\newcommand{\Vtvarrho}{\bm{\varrho}}
\newcommand{\Vtsigma}{\bm{\sigma}}
\newcommand{\Vtvarsigma}{\bm{\varsigma}}
\newcommand{\Vttau}{\bm{\tau}}
\newcommand{\Vtupsilon}{\bm{\upsilon}}
\newcommand{\Vtphi}{\bm{\phi}}
\newcommand{\Vtvarphi}{\bm{\varphi}}
\newcommand{\Vtchi}{\bm{\chi}}
\newcommand{\Vtpsi}{\bm{\psi}}
\newcommand{\Vtomega}{\bm{\omega}}
\newcommand{\Vtdigamma}{\bm{\digamma}}
\newcommand{\VtGamma}{\bm{\Gamma}}
\newcommand{\VtvarGamma}{\bm{\varGamma}}
\newcommand{\VtDelta}{\bm{\Delta}}
\newcommand{\VtvarDelta}{\bm{\varDelta}}
\newcommand{\VtTheta}{\bm{\Theta}}
\newcommand{\VtvarTheta}{\bm{\varTheta}}
\newcommand{\VtLambda}{\bm{\Lambda}}
\newcommand{\VtvarLambda}{\bm{\varLambda}}
\newcommand{\VtXi}{\bm{\Xi}}
\newcommand{\VtvarXi}{\bm{\varXi}}
\newcommand{\VtPi}{\bm{\Pi}}
\newcommand{\VtvarPi}{\bm{\varPi}}
\newcommand{\VtSigma}{\bm{\Sigma}}
\newcommand{\VtvarSigma}{\bm{\varSigma}}
\newcommand{\VtUpsilon}{\bm{\Upsilon}}
\newcommand{\VtvarUpsilon}{\bm{\varUpsilon}}
\newcommand{\VtPhi}{\bm{\Phi}}
\newcommand{\VtvarPhi}{\bm{\varPhi}}
\newcommand{\VtPsi}{\bm{\Psi}}
\newcommand{\VtvarPsi}{\bm{\varPsi}}
\newcommand{\VtOmega}{\bm{\Omega}}
\newcommand{\VtvarOmega}{\bm{\varOmega}}
%==========================


%bibtexまわり==========================
\makeatletter
\newcommand{\isJapanese}[1]{%
  % 先頭が日本語か英語か判断する関数（未使用）
  % https://blog.wtsnjp.com/2017/03/31/tex-by-topic2/
  \protected@edef\mystring{#1}%
  % \mystring\relax%
  \StrLeft{\mystring}{1}[\myfirstchar]%
  \myfirstchar%
  \ifnum\kcatcode\expandafter`\myfirstchar=15 % 15は和文以外
    The string is not Japanese.%
  \else
    The string is Japanese.%
  \fi
}
% 参考文献の日本語論文誌名が太字になるのを無理やり修正．
\renewcommand{\emph}[1]{\textit{#1}}
\makeatother

\usepackage[
  backend=bibtex,
  style=authoryear,
  maxbibnames=99,
  maxcitenames=2,
  % giveninits=true, % first nameをイニシャルにする
  dashed=false,
  natbib=true,
  url=false,
  doi=false]{biblatex}
\addbibresource{../cls/refs.bib} %ここにbibファイルの名前を書く
\DeclareNameAlias{author}{last-first} % co-authorも姓名の順番にする
\DeclareFieldFormat*{issn}{{}} %issnを表示しない
\DeclareFieldFormat*{isbn}{{}} %isbnを表示しない
\DeclareFieldFormat*{title}{{#1}} % タイトルからダブルクオーテーションをはずす
\renewbibmacro{in:}{} % in: Some journal の "in:" を取る
\AtEveryBibitem{\clearfield{month}}
\AtEveryCitekey{\clearfield{month}}


% ------------------------------------------------
% 日本語の参考文献を設定
% https://obsica.com/biblatex-japanese-config/を参考
% \ExecuteBibliographyOptions{
%   date = year,  % 日付は年のみを表示
%   maxbibnames=20,  % 参考文献リストで表示する著者の最大数
%   maxcitenames=2,  % 引用時の著者の最大数
%   maxnames=3,  % 表示する著者の最大数。超えるとminnamesだけ表示して後は省略する
%   minnames=1,  % 表示する著者の最小数
% }

%% 著者名のフォーマットを宣言
%% biblatex.defのfamily-givenとlabelnameを日本語用に
\DeclareNameFormat{japanese}{%参考文献リストでのフォーマット
  \usebibmacro{name:family-given}
  {\namepartfamily}
  {\namepartgiven}
  {\namepartprefix}
  {\namepartsuffix}%
  \usebibmacro{name:andothers}}

\DeclareNameFormat{labelname-japanese}{% 文中でのフォーマット
  \ifcase\value{uniquename}%
    \usebibmacro{name:family}
    {\namepartfamily}
    {\namepartgiven}
    {\namepartprefix}
    {\namepartsuffix}%
  \or
    \usebibmacro{name:family-given}
    {\namepartfamily}
    {\namepartgiven}
    {\namepartprefix}
    {\namepartsuffix}%
  \fi
  ら}

%% 参考文献リストでの表記を設定
\AtEveryBibitem{%
  \iffieldequalstr{langid}{japanese}
  {\DeclareNameAlias{default}{japanese}%
    \DeclareNameAlias{sortname}{japanese}%
    \renewcommand*{\revsdnamepunct}{}% 姓と名の間のコンマを消去
    \DeclareDelimFormat{multinamedelim}{・}% 著者名の区切り文字
    \DeclareDelimFormat{finalnamedelim}{・}% 著者名の最後の区切り文字
    \renewbibmacro*{bytranslator}{% 翻訳者の表記
      \ifnameundef{translator}
      {}
      {\printnames[bytranslator]{translator}\printtext[parens]{訳}}}%
    \renewbibmacro*{bytranslator+others}{\usebibmacro{bytranslator}}%
    % タイトルの書式
    \DeclareFieldFormat*{title}{#1}% タイトル
    \DeclareFieldFormat[book]{title}{#1}% 本タイトルを
    \DeclareFieldAlias{booktitle}[book]{title}% 文献を収録する本のタイトルを『』で囲む
    \DeclareFieldAlias{journaltitle}[book]{title}% 雑誌名を『』で囲む
    \renewbibmacro{in:}{}% In:を削除
  }{}%
}

%% 文中の引用での表記を設定
\AtEveryCitekey{%
  \iffieldequalstr{langid}{japanese}
  {\DeclareNameAlias{labelname}{labelname-japanese}%
    \DeclareDelimFormat{multinamedelim}{・}%
    \DeclareDelimFormat{finalnamedelim}{・}%
    \renewcommand*{\revsdnamepunct}{}%
  }{}%
}
% ------------------------------------------------

% http://otoguro.net/home/latex/bibtex/
% \bibpunct[]{(}{)}{,}{a}{}{,}
\renewcommand{\bibname}{参考文献}
\renewcommand{\refname}{参考文献}

\newcounter{masterflag}
\newcommand{\bibdummy}[1]{
  \ifthenelse{\value{masterflag} = 1}{
    \relax
  }{
    \ifthenelse{#1 = 1}{
      \renewcommand{\bibname}{参考文献}
      \renewcommand{\refname}{参考文献}
      \printbibliography
    }{
      \relax
    }
  }
}